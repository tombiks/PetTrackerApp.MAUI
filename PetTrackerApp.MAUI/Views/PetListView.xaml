<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:lang="clr-namespace:PetTrackerApp.MAUI.Resources.Languages"
             xmlns:helpers="clr-namespace:PetTrackerApp.MAUI.Helpers"
             xmlns:dto="clr-namespace:PetTrackerApp.Data.Dtos;assembly=PetTrackerApp.Data"
             x:Class="PetTrackerApp.MAUI.Views.PetListView"
             Title="PetListView"
             NavigationPage.HasNavigationBar="False">

    <!-- Ana Grid: Header + Pet Listesi -->
    <Grid RowDefinitions="Auto, *">

        <!-- ==================== ROW 0: HEADER ==================== -->
        <Grid Grid.Row="0"
              x:Name="ExpandedHeader"
              HeightRequest="250"
              VerticalOptions="Start">

            <Grid.Shadow>
                <Shadow Brush="Black"
                        Opacity="0.5"
                        Offset="0,5"
                        Radius="10" />
            </Grid.Shadow>

            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#667EEA" Offset="0.0" />
                    <GradientStop Color="#764BA2" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>

            <!-- Ayarlar Butonu -->
            <Button ImageSource="icon_option.png"
                    BackgroundColor="#40FFFFFF"
                    CornerRadius="22"
                    WidthRequest="40"
                    HeightRequest="40"
                    HorizontalOptions="Start"
                    VerticalOptions="Start"
                    Margin="10,10,0,0"
                    SemanticProperties.Description="Dil ve Uygulama AyarlarÄ±"
                    SemanticProperties.Hint="Uygulama ayarlarÄ±nÄ± aÃ§ar">
                <!--<Button.Behaviors>
                    <toolkit:TouchBehavior
                        Command="{Binding SettingsCommand}"
                        PressedOpacity="0.6"
                        PressedScale="0.98" />
                </Button.Behaviors>-->
            </Button>

            <!-- Logo ve Slogan -->
            <VerticalStackLayout Spacing="0"
                                 HorizontalOptions="Center"
                                 VerticalOptions="Center"
                                 Margin="0,-30,0,0">

                <Image Source="{StaticResource PetPlus_Logo}"
                       Aspect="AspectFit"
                       WidthRequest="200"
                       HeightRequest="200"
                       HorizontalOptions="Center"
                       SemanticProperties.Description="UygulamanÄ±n logosu" />

                <Image Source="{StaticResource PetPlus_Text}"
                       Aspect="AspectFit"
                       WidthRequest="200"
                       HeightRequest="105"
                       HorizontalOptions="Center"
                       Margin="0,-80,0,0"
                       SemanticProperties.Description="UygulamanÄ±n text gÃ¶rseli"/>

                <Label Text="{x:Static lang:AppResources.App_Slogan}"
                       FontSize="15"
                       TextColor="White"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"
                       Margin="0,-20,0,0"
                       SemanticProperties.Description="UygulamanÄ±n sloganÄ±" />

            </VerticalStackLayout>
        </Grid>

        <!-- ==================== ROW 1: PET LÄ°STESÄ° ==================== -->
        <Grid Grid.Row="1">

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                               IsVisible="{Binding IsLoading}"
                               Color="#764BA2"
                               VerticalOptions="Center"
                               HorizontalOptions="Center" />

            <!-- Pet Listesi -->
            <CollectionView ItemsSource="{Binding Pets}"
                            IsVisible="{Binding IsNotLoading}"
                            Margin="16,10,16,0">

                <!-- Grid Layout: 2 columns -->
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="2"
                                     HorizontalItemSpacing="8"
                                     VerticalItemSpacing="8"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="dto:PetDto">

                        <Border StrokeThickness="3"
                                Stroke="#E8E8E8"
                                BackgroundColor="White">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="24"/>
                            </Border.StrokeShape>
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.06" Radius="8" Offset="0,2"/>
                            </Border.Shadow>

                            <!-- TouchBehavior -->
                            <Border.Behaviors>
                                <toolkit:TouchBehavior
                                    PressedOpacity="0.95"
                                    PressedScale="0.995">
                                    <!-- Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.GoToPetDetailCommand}"
                                    CommandParameter="{Binding .}" -->
                                </toolkit:TouchBehavior>
                            </Border.Behaviors>

                            <Grid RowDefinitions="*,Auto" Padding="16">

                                <!-- Pet Avatar Section -->
                                <Grid Grid.Row="0" RowDefinitions="Auto,*">

                                    <!-- Edit Button -->
                                    <Button Text="{x:Static helpers:IconConstants.PetEdit}"
                                            FontFamily="pets"
                                            TextColor="AntiqueWhite"
                                            FontSize="33"
                                            BackgroundColor="#FFA500"
                                            CornerRadius="10"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            HorizontalOptions="End"
                                            Padding="0,3,0,0">
                                        <!--<Button.Behaviors>
                                            <toolkit:TouchBehavior
                                                Command="{Binding SettingsCommand}"
                                                CommandParameter="{Binding .}"
                                                PressedOpacity="0.6"
                                                PressedScale="0.98" />
                                        </Button.Behaviors>-->
                                    </Button>

                                    <!-- Avatar Circle + Type Icon Badge -->
                                    <Grid Grid.Row="1"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center"
                                          Margin="0,8">

                                        <!-- Avatar Circle -->
                                        <Border WidthRequest="110"
                                                HeightRequest="110"
                                                StrokeThickness="4"
                                                Stroke="#F0F0F0"
                                                BackgroundColor="#F8F9FA">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="55"/>
                                            </Border.StrokeShape>

                                            <!-- Grid: Image ve Label'i aynÄ± yerde tut -->
                                            <Grid>
                                                <!-- FotoÄŸraf VARSA Image gÃ¶ster -->
                                                <Image Source="{Binding DisplayPicture}"
                                                       Aspect="AspectFill"
                                                       IsVisible="{Binding HasPhoto}"/>

                                                <!-- FotoÄŸraf YOKSA Icon gÃ¶ster -->
                                                <Label Text="{x:Static helpers:IconConstants.PetAvatarDefault}"
                                                       FontFamily="pets"
                                                       FontSize="80"
                                                       TextColor="#FFA500"
                                                       HorizontalOptions="Center"
                                                       VerticalOptions="Center"
                                                       IsVisible="{Binding HasNoPhoto}"/> 
                                            </Grid>

                                        </Border>
                                        <!-- Type Icon Badge (Font Icon + GenderColor) -->
                                        <Border WidthRequest="36"
                                                HeightRequest="36"
                                                BackgroundColor="White"
                                                StrokeThickness="2"
                                                Stroke="#F0F0F0"
                                                HorizontalOptions="End"
                                                VerticalOptions="End"
                                                Margin="0,0,2,-5">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="18"/>
                                            </Border.StrokeShape>
                                            <Border.Shadow>
                                                <Shadow Brush="Black" Opacity="0.1" Radius="4" Offset="0,2"/>
                                            </Border.Shadow>

                                            <Label Text="{Binding PetTypeIcon}"
                                                   FontFamily="pets"
                                                   FontSize="23"
                                                   TextColor="{Binding GenderColor}"
                                                   HorizontalOptions="Center"
                                                   VerticalOptions="Center"/>
                                        </Border>
                                    </Grid>
                                </Grid>

                                <!-- Pet Info -->
                                <VerticalStackLayout Grid.Row="1"
                                                     Spacing="8"
                                                     Margin="0,16,0,0">

                                    <!-- Name + Gender Symbol -->
                                    <Border StrokeThickness="0"
                                            BackgroundColor="{Binding GenderColor}"
                                            HorizontalOptions="Center"
                                            Padding="12,6">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>

                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="{Binding name}"
                                                   FontSize="17"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   VerticalOptions="Center"/>

                                            <Label Text="{Binding GenderSymbol}"
                                                   FontSize="20"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   VerticalOptions="Center"/>
                                        </HorizontalStackLayout>
                                    </Border>

                                    <!-- Birth Date -->
                                    <Border StrokeThickness="0"
                                            HorizontalOptions="Center"
                                            Padding="12,6"
                                            BackgroundColor="#8FE37D">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>

                                        <HorizontalStackLayout HorizontalOptions="Center" Spacing="4">
                                            <Label Text="ðŸŽ‚"
                                                   FontSize="14"
                                                   VerticalOptions="Center"/>
                                            <Label Text="{Binding dateOfBirth, StringFormat='{0:dd/MM/yyyy}'}"
                                                   TextColor="White"
                                                   FontSize="13"
                                                   VerticalOptions="Center"/>
                                        </HorizontalStackLayout>
                                    </Border>

                                </VerticalStackLayout>
                            </Grid>
                        </Border>

                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <!-- BoÅŸ Liste MesajÄ± -->
                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center"
                                         VerticalOptions="Center"
                                         Spacing="10"
                                         Margin="20">
                        <Label Text="ðŸ¾"
                               FontSize="48"
                               HorizontalOptions="Center" />
                        <Label Text="HenÃ¼z pet eklenmemiÅŸ"
                               FontSize="18"
                               TextColor="#666666"
                               HorizontalTextAlignment="Center" />
                        <Label Text="Ä°lk petinizi eklemek iÃ§in + butonuna tÄ±klayÄ±n"
                               FontSize="14"
                               TextColor="#999999"
                               HorizontalTextAlignment="Center" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

            </CollectionView>

        </Grid>

    </Grid>

</ContentPage>
